---
title: 虚拟机
date: 2025-09-13 16:44:22
tags:
---

# 一、什么是虚拟机？

1. 虚拟机(Virtual Machine)指通过软件模拟的具有完整硬件系统功能的、运行在一个完全隔离环境中的完整计算机系统。

2. 所谓虚拟机，就是一台虚拟的计算机。它是一款软件，用来执行一系列虚拟计算机指令。

虚拟机可以分为两类：

1. 系统虚拟机：它们完全是对物理计算机的仿真，提供了一个可运行完整操作系统的软件平台，比如Visual Box，VMware。

2. 程序虚拟机：专门为执行单个计算机程序而设计，比如Java虚拟机，在Java虚拟机中执行的指令称为Java字节码指令。

无论是系统虚拟机还是程序虚拟机，在上面运行的软件都被限制于虚拟机提供的资源中。

# 二、Java虚拟机

## 2.1 什么是Java虚拟机？

1. Java虚拟机是一台执行字节码的虚拟计算机，它拥有独立的运行机制，其运行的Java字节码也未必由Java语言编译而成。

2. JVM平台的各种语言可以共享Java虚拟机带来的跨平台性、优秀的垃圾回收机制，以及可靠的即时编译器。

3. Java技术的核心就是Java虚拟机，因为所有的Java程序都运行在Java虚拟机内部。

可以这样理解:

1. JVM类似于一台小电脑运行在windows或者linux这些操作系统环境下。它与操作系统直接交互，不与硬件直接交互，操作系统可以帮我们完成和硬件交互的工作。

2. JVM不是只支持Java字节码，只要编程语言能够遵循字节码文件的规范，都可以在JVM内运行
     

## 2.2 Java虚拟机是干什么的？

1. Java虚拟机就是二进制字节码的运行环境，负责装载字节码到其内部，解释/编译为对应平台上的机器指令执行。

2. 每一条Java指令，Java虚拟机规范中都有详细的定义，如怎么取操作数，怎么处理操作数，操作结果放在哪里。

Java虚拟机的主要特点

1. 一次编译，到处运行

2. 自动内存管理

3. 自动垃圾回收机制

"一次编译，到处运行"怎么理解？

对于不同的操作系统，Oracle提供了不同版本的JVM，所以只需要将程序编译成一个.class文件，就可以运行在不同操作系统的JVM上

指令集架构模型

1. 基于栈的指令集架构

  ○ 设计和实现更简单，适用于资源受限的系统；
  ○ 避开了寄存器的分配难题：使用零地址指令方式分配；
  ○ JVM指令流中的指令大部分是零地址指令，其执行过程依赖于操作栈。指令集更小，编译器容易实现；
  ○ 不需要硬件支持，可移植性更好，更好实现跨平台。

由于跨平台性的设计，Java的指令都是根据栈来设计的。

2. 基于寄存器的指令集架构

  ○ 典型的应用是X86的二进制指令集：比如传统的PC以及Android的Davlik虚拟机；
  ○ 基于寄存器的指令集架构则完全依赖硬件，可移植性差；
  ○ 性能优秀，执行更高效；
  ○ 花费更少的指令去完成一项操作；
  ○ 大部分情况下，基于寄存器架构的指令集往往都以一地址指令、二地址指令和三地址指令为主

3. 二者区别：举例说明
 

寄存器执行性能更好，为什么不更改成根据寄存器来设计？

  ○ 不同平台CPU架构不同，为了实现跨平台性，所以不能设计为基于寄存器的；
  ○ 基于栈设计实现要简单一些；
  ○ 基于栈在非资源受限平台(嵌入式)也是可以用的，没有必要更改。

JVM的生命周期

1. 启动

  ○ Java虚拟机的启动是通过引导类加载器(bootstrap class loader)创建一个初始类(initial class)来完成的，这个类是由虚拟机的具体实现(虚拟机有不同公司开发的不同的版本)指定的。

2. 执行

  ○ 一个运行中的Java虚拟机有着一个清晰的任务：执行Java程序；
  ○ 程序开始执行时他才运行，程序结束时他就停止；
  ○ 执行一个所谓的Java程序的时候，真真正正在执行的是一个叫做Java虚拟机的进程。

3. 退出

  ○ 程序正常执行结束；
  ○ 程序在执行过程中遇到了异常(未被捕获)或错误而异常终止；
  ○ 由于操作系统出现错误而导致Java虚拟机进程终止；
  ○ 某线程调用Runtime类或System类的exit方法，或Runtime类的halt方法，并且Java安全管理也允许这次exit或halt操作。
  ○ JNI加载或卸载Java虚拟机，Java虚拟机退出

JVM整体结构

1. 整体结构图

2. 详细结构图
